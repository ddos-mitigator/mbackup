# Python3 cкрипт резервного копирования-восстановления

* Каждая версия скрипта поддерживает работу с митигатором текущей стабильной версией,
* При необходимости обновления через версию, нужно последовательно обновить файл резервной копии соответствующими версиями скрипта;

**ВОССТАНОВЛЕНИЕ ВОЗМОЖНО ТОЛЬКО НА ЧИСТУЮ ИНСТАЛЯЦИЮ (без конфликтующих настроек).** Восстановление на преднастроенную инсталяцию не гарантируется

## Функции

* Резервное копирование политик, правил, групп, настроек и переключателей контрмер для всех политик и глобальной защиты, настроек автодетектирования, настроек bgp;
* Восстановление из файла вышеупомянутых параметров;

## Аргументы

Версии скрипта `v2.1905.0` имеет один обязательный и семь необязательных (ситуационных) аргумента.

**ОБЯЗАТЕЛЬНЫЕ**

* `TASK` -- функция из списка: `backup, restore` определяющая выполняюему функцию

**НЕОБЯЗАТЕЛЬНЫЕ**

* `-s, --server` -- указывает на целевой сервер для резервного копирования или восстановления,
* `-u, --user` -- логин системного администатора, используемый для авторизации на целевом сервере для резервного копирования или восстановления,
* `-p, --passwd` -- пароль системного администатора, используемый для авторизации на целевом сервере для резервного копирования или восстановления,
* `-i, --input` -- путь к файлу резервной копии, используемый при восстановлении или обновлении файла,
* `-o, --output` -- путь к файлу, в который будет записан результат резервного копирования, либо обновления резервной копии,
* `-k, --insecure` -- если параметр задан, отключается проверка сертификата при выполнении запросов;

## Заметки

* Время резерного копирования и/или восстановления может показаться долгим, в случае отсутсвия библиотеки `requests` (около 5 минут для 100 политик),
* Для запуска скрипта требуется `Python3` версии `3.6` и выше,
* При резерном копировании возможно появление `WARNING` с ошибкой `404 Not Found` для настроек некоторых контрмер.
Такие сообщения допустимы для контрмер (в частности, `DNS` и `MCR`) политик, созданных в предыдущих версиях и не настроенных до сих пор.
В иных сценариях рекомендуется связаться с поддержкой для консультации;

## Упаковка в исполняемый архив

```shellscript
cp mbackup.py __main__.py     && \
    zip main __main__.py backup.py mbase.py mitigator.py restore.py  && \
    echo '#!/usr/bin/env python3' | cat - main.zip > mbackup         && \
    chmod +x mbackup; \
    rm __main__.py main.zip
```
